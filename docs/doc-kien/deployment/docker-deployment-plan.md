# K·∫ø Ho·∫°ch Tri·ªÉn Khai Docker - Service Center App

**T√°c gi·∫£**: Kienta
**Ng√†y t·∫°o**: 2026-02-06
**Phi√™n b·∫£n**: 1.0
**Tr·∫°ng th√°i**: Draft

---

## üìã T·ªïng Quan

T√†i li·ªáu n√†y ph√¢n t√≠ch hi·ªán tr·∫°ng Docker setup c·ªßa Service Center App v√† ƒë·ªÅ xu·∫•t k·∫ø ho·∫°ch ho√†n thi·ªán ƒë·ªÉ s·∫µn s√†ng deploy production.

### M·ª•c Ti√™u
- ‚úÖ Deploy to√†n b·ªô stack (Next.js + Supabase) ch·ªâ v·ªõi Docker
- ‚úÖ H·ªó tr·ª£ 2 deployment modes: Local v√† Production
- ‚úÖ T·ª± ƒë·ªông h√≥a t·ªëi ƒëa qu√° tr√¨nh setup v√† deployment
- ‚úÖ ƒê·∫£m b·∫£o security v√† scalability

---

## üìä Ph√¢n T√≠ch Hi·ªán Tr·∫°ng

### ‚úÖ Nh·ªØng G√¨ ƒê√£ C√≥ (ƒê·ªô Ho√†n Thi·ªán: 95%)

#### 1. **Dockerfile** ‚úÖ
**V·ªã tr√≠**: `/Dockerfile`

**ƒê·∫∑c ƒëi·ªÉm**:
- Multi-stage build (base ‚Üí deps ‚Üí builder ‚Üí runner)
- Base image: Node.js 22 Alpine (lightweight)
- Security: Non-root user (nextjs:nodejs)
- Signal handling: dumb-init
- Health check: T√≠ch h·ª£p s·∫µn
- Port: 3025

**ƒêi·ªÉm m·∫°nh**:
- ‚úÖ Optimized layers gi·∫£m image size
- ‚úÖ Production-ready security practices
- ‚úÖ Proper signal handling cho graceful shutdown

**V·∫•n ƒë·ªÅ**:
- ‚ö†Ô∏è `output: 'standalone'` b·ªã comment out trong `next.config.ts:16`
- ‚ö†Ô∏è C·∫ßn verify `/api/health` endpoint t·ªìn t·∫°i

#### 2. **Docker Compose** ‚úÖ
**V·ªã tr√≠**: `/docker-compose.yml`

**Services (14 containers)**:
```yaml
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Service Stack                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Frontend/Backend:                      ‚îÇ
‚îÇ  ‚Ä¢ app (Next.js)           :3025        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Supabase Infrastructure:               ‚îÇ
‚îÇ  ‚Ä¢ db (PostgreSQL 15)      :5432*       ‚îÇ
‚îÇ  ‚Ä¢ kong (API Gateway)      :8000        ‚îÇ
‚îÇ  ‚Ä¢ auth (GoTrue)           :9999*       ‚îÇ
‚îÇ  ‚Ä¢ rest (PostgREST)        :3000*       ‚îÇ
‚îÇ  ‚Ä¢ realtime                :4000*       ‚îÇ
‚îÇ  ‚Ä¢ storage                 :5000*       ‚îÇ
‚îÇ  ‚Ä¢ studio                  :3000        ‚îÇ
‚îÇ  ‚Ä¢ meta                    :8080*       ‚îÇ
‚îÇ  ‚Ä¢ functions (Deno)        :8083*       ‚îÇ
‚îÇ  ‚Ä¢ analytics (Logflare)    :4000*       ‚îÇ
‚îÇ  ‚Ä¢ imgproxy                :5001*       ‚îÇ
‚îÇ  ‚Ä¢ vector (logging)        :9001*       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  * Internal ports only                  ‚îÇ
‚îÇ  Exposed ports: 3025, 8000, 3000        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**ƒêi·ªÉm m·∫°nh**:
- ‚úÖ Full Supabase self-hosted stack
- ‚úÖ Health checks cho t·∫•t c·∫£ critical services
- ‚úÖ Proper dependency management (`depends_on` v·ªõi conditions)
- ‚úÖ Volumes cho data persistence
- ‚úÖ Network isolation (internal Docker network)

**V·∫•n ƒë·ªÅ**:
- ‚ö†Ô∏è Ch∆∞a c√≥ resource limits (memory/CPU)
- ‚ö†Ô∏è Thi·∫øu restart policies cho m·ªôt s·ªë services

#### 3. **Environment Configuration** ‚úÖ
**Files**:
- `.env.docker.example` - Template ƒë·∫ßy ƒë·ªß (199 d√≤ng)
- `.env.example` - Local development
- `supabase/config.toml` - Supabase CLI config

**H·ªó tr·ª£ 2 Deployment Modes**:

##### Mode 1: Local Development
```bash
DEPLOYMENT_MODE=local
SITE_URL=http://localhost:3025
NEXT_PUBLIC_SUPABASE_URL=http://localhost:8000
KONG_PORT=8000
```
- ‚úÖ Kh√¥ng c·∫ßn Cloudflare Tunnel
- ‚úÖ Quick testing
- ‚úÖ Development-friendly

##### Mode 2: Production (v·ªõi Cloudflare Tunnel)
```bash
DEPLOYMENT_MODE=production
SITE_URL=https://service.example.com
NEXT_PUBLIC_SUPABASE_URL=https://api.example.com
KONG_PORT=8000
```
- ‚úÖ Secure external access
- ‚úÖ Automatic SSL/TLS
- ‚úÖ DDoS protection
- ‚úÖ Global CDN

**Environment Variables Key**:
```bash
# Application
APP_PORT=3025                    # User configures
STUDIO_PORT=3000                 # Auto-calculated
KONG_PORT=8000                   # Auto-calculated

# Secrets (auto-generated by setup script)
POSTGRES_PASSWORD                # 32 bytes hex
JWT_SECRET                       # 32 bytes hex
SUPABASE_ANON_KEY               # Generated from JWT_SECRET
SUPABASE_SERVICE_ROLE_KEY       # Generated from JWT_SECRET
DASHBOARD_PASSWORD              # 16 bytes hex

# URLs (auto-derived from mode)
SUPABASE_URL                    # Internal: http://kong:8000
NEXT_PUBLIC_SUPABASE_URL        # External: depends on mode
SITE_URL                        # depends on mode
```

#### 4. **Database Schema** ‚úÖ
**V·ªã tr√≠**: `/docs/data/schemas/`

**32 schema files** v·ªõi th·ª© t·ª± th·ª±c thi r√µ r√†ng:
```
100_* - Enums and sequences (1 file)
150_* - Base functions (1 file)
200_* - Core tables (6 files)
    - profiles, customers, products
    - service_tickets, service_requests
    - inventory_documents, tasks, warehouse
300_* - Foreign key constraints (2 files)
500_* - Business logic functions (3 files)
600_* - Triggers (3 files)
    - Stock management
    - Default warehouse
    - Serial counts
700_* - Reporting views (ch∆∞a c√≥)
800_* - RLS policies (ch∆∞a c√≥)
900_* - Seed data (ch∆∞a c√≥)
```

**ƒêi·ªÉm m·∫°nh**:
- ‚úÖ Schema files l√† source of truth
- ‚úÖ Numbered naming convention
- ‚úÖ Script ƒë·ªÉ apply: `docs/data/schemas/setup_schema.sh`

**V·∫•n ƒë·ªÅ**:
- ‚ö†Ô∏è Schema ch∆∞a ƒë∆∞·ª£c auto-apply khi DB init
- ‚ö†Ô∏è C·∫ßn manual run script sau khi start services

#### 5. **Automation Scripts** ‚úÖ
**V·ªã tr√≠**: `/docker/scripts/`

##### `setup-instance.sh` (‚≠ê Main Setup)
- Generate t·∫•t c·∫£ secrets (URL-safe hex format)
- Generate Supabase API keys t·ª´ JWT_SECRET
- Copy config files t·ª´ `docs/references/volumes/`
- T·∫°o `.env` file v·ªõi t·∫•t c·∫£ settings
- T·∫°o `INSTANCE_INFO.txt` v·ªõi access URLs
- **H·ªó tr·ª£ interactive mode**: `--interactive` flag

**Usage**:
```bash
./docker/scripts/setup-instance.sh --interactive
```

##### `deploy.sh` (‚≠ê Main Entry Point)
Interactive menu v·ªõi 7 options:
1. **Complete fresh deployment** - Full workflow
2. Build and deploy only
3. Update application only
4. Restart all services
5. View logs
6. Stop all services
7. Clean up (x√≥a volumes + .env)

**Workflow Option 1**:
```
Step 1/5: Run setup-instance.sh
Step 2/5: Pull Docker images
Step 3/5: Build Docker images
Step 4/5: Start all services
Step 5/5: Apply database schema
```

##### `apply-schema.sh`
- Validate DB ƒëang ch·∫°y
- Apply schema files theo th·ª© t·ª±
- Create storage buckets
- Verify deployment success

##### `generate-keys.js`
- Generate `SUPABASE_ANON_KEY` t·ª´ JWT_SECRET
- Generate `SUPABASE_SERVICE_ROLE_KEY`
- 10-year expiration
- JWT format chu·∫©n

##### `backup.sh`
- Backup PostgreSQL database
- Backup uploads directory
- Backup .env file
- Clean old backups (>7 days)

**ƒêi·ªÉm m·∫°nh**:
- ‚úÖ Full automation c·ªßa deployment workflow
- ‚úÖ Interactive configuration
- ‚úÖ Error handling t·ªët
- ‚úÖ Colored output d·ªÖ ƒë·ªçc

#### 6. **Documentation** ‚úÖ
**Files**:
- `docker/README.md` - Chi ti·∫øt 481 d√≤ng
- `DEPLOYMENT.md` - Production deployment guide (c√≥ th·ªÉ c√≥)
- `DEVELOPMENT.md` - Local development guide (c√≥ th·ªÉ c√≥)

**N·ªôi dung cover**:
- ‚úÖ Directory structure
- ‚úÖ File overview
- ‚úÖ Quick start (automated + manual)
- ‚úÖ Network architecture
- ‚úÖ Environment variables explained
- ‚úÖ Build-time vs Runtime variables
- ‚úÖ Security notes
- ‚úÖ Maintenance commands

---

## ‚ö†Ô∏è Nh·ªØng G√¨ C√≤n Thi·∫øu

### 1. **Next.js Standalone Output** üî¥ CRITICAL

**V·∫•n ƒë·ªÅ**:
```typescript
// next.config.ts:16
// output: "standalone",  // Disabled for local development
```

**Impact**:
- Docker build s·∫Ω kh√¥ng t·∫°o `.next/standalone` directory
- Container s·∫Ω ch·ª©a to√†n b·ªô node_modules (bloat)
- Image size l·ªõn kh√¥ng c·∫ßn thi·∫øt

**Solution**:
```typescript
output: "standalone",  // Enable for Docker deployment
```

**C√°ch enable/disable linh ho·∫°t**:
```typescript
const nextConfig: NextConfig = {
  output: process.env.DOCKER_BUILD === 'true' ? 'standalone' : undefined,
  // ... rest
};
```

Trong Dockerfile:
```dockerfile
ENV DOCKER_BUILD=true
RUN pnpm build
```

**Timeline**: ‚è±Ô∏è 5 ph√∫t

---

### 2. **API Health Endpoint** üü° HIGH

**Dockerfile expects**:
```dockerfile
HEALTHCHECK ... "http://localhost:3025/api/health"
```

**C·∫ßn verify**:
- [ ] File `src/app/api/health/route.ts` c√≥ t·ªìn t·∫°i?
- [ ] Endpoint tr·∫£ v·ªÅ status 200 khi app healthy?

**N·∫øu ch∆∞a c√≥, c·∫ßn t·∫°o**:
```typescript
// src/app/api/health/route.ts
import { NextResponse } from 'next/server';

export async function GET() {
  // Optional: Check DB connection
  // Optional: Check critical services

  return NextResponse.json(
    { status: 'ok', timestamp: new Date().toISOString() },
    { status: 200 }
  );
}
```

**Timeline**: ‚è±Ô∏è 10 ph√∫t

---

### 3. **Database Schema Auto-Apply** üü° MEDIUM

**Hi·ªán tr·∫°ng**: Manual execution
```bash
# Step 1: Start services
docker compose up -d

# Step 2: Wait for DB ready (~30s)

# Step 3: Apply schema manually
./docker/scripts/apply-schema.sh
```

**Options ƒë·ªÉ improve**:

#### Option A: Init Container (Recommended)
```yaml
# docker-compose.yml
services:
  db-init:
    image: postgres:15
    depends_on:
      db:
        condition: service_healthy
    volumes:
      - ./docs/data/schemas:/schemas:ro
    command: >
      bash -c "
        cd /schemas &&
        ./setup_schema.sh postgres://postgres:$$POSTGRES_PASSWORD@db:5432/postgres
      "
    restart: "no"
```

**Pros**:
- ‚úÖ Truly automated
- ‚úÖ Runs only once
- ‚úÖ Clear separation of concerns

**Cons**:
- ‚ö†Ô∏è Requires setup_schema.sh to accept DB URL param

#### Option B: DB Entrypoint Scripts
```yaml
# docker-compose.yml
db:
  volumes:
    - ./docs/data/schemas:/docker-entrypoint-initdb.d/migrations:Z
```

**Pros**:
- ‚úÖ Standard PostgreSQL pattern
- ‚úÖ Auto-runs on first start

**Cons**:
- ‚ö†Ô∏è Only runs if DB data dir is empty
- ‚ö†Ô∏è Won't run on subsequent starts
- ‚ö†Ô∏è Files must be .sql (our setup_schema.sh is bash)

#### Option C: App Init Logic
Add init logic trong Next.js app startup:
```typescript
// src/lib/init.ts
async function initDatabase() {
  const isFirstRun = await checkIfSchemaExists();
  if (!isFirstRun) {
    await runMigrations();
  }
}
```

**Pros**:
- ‚úÖ Full control from app
- ‚úÖ Can include seed data logic

**Cons**:
- ‚ö†Ô∏è Mixing concerns (app should not manage DB schema)
- ‚ö†Ô∏è Requires .sql files to be bundled

**Recommendation**: Keep manual for now, document clearly
- Current approach works well
- Clear separation of concerns
- Easy to debug if issues

**Timeline**: ‚è±Ô∏è 2-4 hours (if implementing Option A)

---

### 4. **Resource Limits** üü° MEDIUM

**V·∫•n ƒë·ªÅ**: Services kh√¥ng c√≥ memory/CPU limits

**Impact**:
- ‚ö†Ô∏è M·ªôt service c√≥ th·ªÉ consume to√†n b·ªô host resources
- ‚ö†Ô∏è No QoS guarantees
- ‚ö†Ô∏è Kh√≥ troubleshoot performance issues

**Solution**: Add deploy configs
```yaml
services:
  app:
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '2.0'
        reservations:
          memory: 512M
          cpus: '0.5'
    restart: unless-stopped

  db:
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '2.0'
        reservations:
          memory: 1G
          cpus: '1.0'
    restart: unless-stopped
```

**Recommended Limits** (cho VPS 8GB RAM):
```
Total System:      8GB RAM, 4 CPUs
Reserve for OS:    1GB RAM, 0.5 CPUs
Available:         7GB RAM, 3.5 CPUs

Service Allocation:
- db (PostgreSQL): 3GB RAM, 1.5 CPUs (largest consumer)
- app (Next.js):   2GB RAM, 1.0 CPU
- kong:            512MB, 0.25 CPU
- auth:            256MB, 0.25 CPU
- storage:         512MB, 0.25 CPU
- realtime:        256MB, 0.25 CPU
- rest:            256MB, 0.25 CPU
- others:          ~1GB total
```

**Timeline**: ‚è±Ô∏è 30 ph√∫t

---

### 5. **Production Hardening** üü¢ NICE-TO-HAVE

#### A. Monitoring & Observability

**Missing**:
- ‚ùå Metrics collection (Prometheus)
- ‚ùå Dashboards (Grafana)
- ‚ùå Alerting
- ‚ùå Distributed tracing

**Solution**: Add monitoring stack
```yaml
# docker-compose.monitoring.yml
services:
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana:latest
    volumes:
      - grafana-data:/var/lib/grafana
      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}

  node-exporter:
    image: prom/node-exporter:latest
    command:
      - '--path.rootfs=/host'
    volumes:
      - '/:/host:ro,rslave'

volumes:
  prometheus-data:
  grafana-data:
```

**Usage**:
```bash
docker compose -f docker-compose.yml -f docker-compose.monitoring.yml up -d
```

**Timeline**: ‚è±Ô∏è 4-6 hours

#### B. Backup Automation

**Current**: Manual script execution

**Solution**: Cron job + Healthchecks.io
```bash
# /etc/cron.d/service-center-backup
0 2 * * * root /path/to/docker/scripts/backup.sh && curl https://hc-ping.com/your-uuid
```

**Or**: Separate backup container
```yaml
# docker-compose.yml
services:
  backup:
    image: alpine:latest
    volumes:
      - ./backups:/backups
      - ./docker/scripts:/scripts:ro
    environment:
      - BACKUP_SCHEDULE=0 2 * * *  # 2 AM daily
    command: crond -f -l 2
    restart: unless-stopped
```

**Timeline**: ‚è±Ô∏è 2 hours

#### C. Reverse Proxy (Alternative to Cloudflare)

**Current**: Cloudflare Tunnel only

**Add**: Nginx/Caddy option for self-hosted
```yaml
# docker-compose.nginx.yml
services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/ssl/private:ro
      - nginx-cache:/var/cache/nginx
    depends_on:
      - app
      - kong

  certbot:
    image: certbot/certbot
    volumes:
      - ./nginx/ssl:/etc/letsencrypt
    entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;'"
```

**Nginx Config Example**:
```nginx
# nginx/nginx.conf
upstream app {
    server app:3025;
}

upstream kong {
    server kong:8000;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /etc/ssl/private/fullchain.pem;
    ssl_certificate_key /etc/ssl/private/privkey.pem;

    location / {
        proxy_pass http://app;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

server {
    listen 443 ssl http2;
    server_name api.yourdomain.com;

    ssl_certificate /etc/ssl/private/fullchain.pem;
    ssl_certificate_key /etc/ssl/private/privkey.pem;

    location / {
        proxy_pass http://kong;
        proxy_set_header Host $host;
    }
}
```

**Timeline**: ‚è±Ô∏è 3-4 hours

#### D. Secrets Management

**Current**: .env file

**For Production**: Docker Secrets
```yaml
# docker-compose.yml
services:
  app:
    secrets:
      - postgres_password
      - jwt_secret
      - supabase_service_role_key
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
      JWT_SECRET_FILE: /run/secrets/jwt_secret

secrets:
  postgres_password:
    file: ./secrets/postgres_password.txt
  jwt_secret:
    file: ./secrets/jwt_secret.txt
```

**Or**: External vault (Vault, AWS Secrets Manager)

**Timeline**: ‚è±Ô∏è 2-3 hours

---

### 6. **Documentation Improvements** üü¢ LOW

**Missing**:
- [ ] Troubleshooting guide v·ªõi common issues
- [ ] Performance tuning guide
- [ ] Scaling guide (vertical vs horizontal)
- [ ] Disaster recovery procedures
- [ ] Security audit checklist

**Timeline**: ‚è±Ô∏è 4-6 hours

---

## üìÖ K·∫ø Ho·∫°ch Tri·ªÉn Khai

### Phase 1: Critical Fixes (Timeline: 1 hour)

#### Task 1.1: Enable Standalone Output
- [ ] Edit `next.config.ts`
- [ ] Enable `output: 'standalone'`
- [ ] Test Docker build
- [ ] Verify image size reduction

#### Task 1.2: Verify Health Endpoint
- [ ] Check if `/api/health` exists
- [ ] If not, create `src/app/api/health/route.ts`
- [ ] Test endpoint returns 200
- [ ] Update health check if needed

#### Task 1.3: Test Full Deployment
- [ ] Run `./docker/scripts/deploy.sh`
- [ ] Select option 1 (Complete fresh deployment)
- [ ] Verify all services start
- [ ] Verify schema applies successfully
- [ ] Test login and basic functionality

**Deliverables**:
- ‚úÖ Working Docker deployment
- ‚úÖ All services healthy
- ‚úÖ Smaller image size

---

### Phase 2: Production Hardening (Timeline: 2-3 hours)

#### Task 2.1: Add Resource Limits
- [ ] Define resource allocation strategy
- [ ] Update `docker-compose.yml` v·ªõi deploy configs
- [ ] Test under load
- [ ] Document recommended specs

#### Task 2.2: Improve Error Handling
- [ ] Add restart policies
- [ ] Configure health check intervals
- [ ] Add startup probes where needed
- [ ] Test failure scenarios

#### Task 2.3: Security Review
- [ ] Rotate all default secrets
- [ ] Review exposed ports
- [ ] Check file permissions
- [ ] Audit environment variables

**Deliverables**:
- ‚úÖ Production-ready docker-compose.yml
- ‚úÖ Resource limits configured
- ‚úÖ Security hardened

---

### Phase 3: Observability (Timeline: 4-6 hours) - OPTIONAL

#### Task 3.1: Add Monitoring Stack
- [ ] Create `docker-compose.monitoring.yml`
- [ ] Configure Prometheus
- [ ] Setup Grafana dashboards
- [ ] Configure alerting rules

#### Task 3.2: Centralized Logging
- [ ] Review Vector configuration
- [ ] Setup log aggregation
- [ ] Create log retention policies
- [ ] Add log-based alerts

#### Task 3.3: Backup Automation
- [ ] Create backup cron job
- [ ] Setup healthchecks.io monitoring
- [ ] Test backup restoration
- [ ] Document recovery procedures

**Deliverables**:
- ‚úÖ Monitoring dashboards
- ‚úÖ Automated backups
- ‚úÖ Alerting configured

---

### Phase 4: Documentation (Timeline: 4-6 hours) - OPTIONAL

#### Task 4.1: Deployment Guides
- [ ] Quick start guide
- [ ] Production deployment guide
- [ ] Multi-instance setup guide
- [ ] Migration guide (t·ª´ dev ‚Üí prod)

#### Task 4.2: Operational Guides
- [ ] Troubleshooting guide
- [ ] Backup & restore procedures
- [ ] Scaling guide
- [ ] Performance tuning guide

#### Task 4.3: Runbooks
- [ ] Incident response procedures
- [ ] Disaster recovery plan
- [ ] Security audit checklist
- [ ] Maintenance calendar

**Deliverables**:
- ‚úÖ Complete documentation set
- ‚úÖ Runbooks for ops team

---

## ‚úÖ Checklist T·ªïng H·ª£p

### Pre-Production (Must-Have)
- [ ] **1.1** - Enable standalone output trong next.config.ts
- [ ] **1.2** - Verify/create `/api/health` endpoint
- [ ] **1.3** - Test full deployment workflow
- [ ] **2.1** - Add resource limits cho all services
- [ ] **2.2** - Configure proper restart policies
- [ ] **2.3** - Security audit v√† rotate secrets
- [ ] Test backup v√† restore procedures
- [ ] Document deployment steps

### Production-Ready (Recommended)
- [ ] **3.1** - Setup monitoring stack
- [ ] **3.2** - Configure centralized logging
- [ ] **3.3** - Automate backup v·ªõi cron
- [ ] Add alerting cho critical metrics
- [ ] Setup SSL/TLS (Cloudflare ho·∫∑c Nginx)
- [ ] Performance testing under load
- [ ] Document troubleshooting procedures

### Production-Excellence (Nice-to-Have)
- [ ] **4.1** - Complete deployment guides
- [ ] **4.2** - Operational runbooks
- [ ] **4.3** - Disaster recovery plan
- [ ] Multi-instance deployment tested
- [ ] Horizontal scaling documented
- [ ] Security audit completed
- [ ] Compliance check (GDPR, etc.)

---

## üéØ K·∫øt Lu·∫≠n

### ƒê·ªô S·∫µn S√†ng: **95%** ‚úÖ

Project ƒë√£ c√≥ infrastructure g·∫ßn nh∆∞ ho√†n ch·ªânh ƒë·ªÉ deploy production.

**Strengths**:
- ‚úÖ Full Docker/Compose configuration
- ‚úÖ Complete Supabase self-hosted stack
- ‚úÖ Automated setup v√† deployment scripts
- ‚úÖ Support 2 deployment modes
- ‚úÖ Comprehensive documentation

**Critical Path** (c·∫ßn l√†m tr∆∞·ªõc khi production):
1. Enable standalone output (5 ph√∫t)
2. Verify health endpoint (10 ph√∫t)
3. Add resource limits (30 ph√∫t)
4. Full deployment test (15 ph√∫t)

**Total Time to Production-Ready**: ~1-2 hours

**Recommended Enhancements** (sau khi deploy):
- Monitoring stack (4-6 hours)
- Backup automation (2 hours)
- Complete documentation (4-6 hours)

---

## üìö T√†i Li·ªáu Tham Kh·∫£o

### Internal Docs
- `/docker/README.md` - Docker configuration guide
- `/CLAUDE.md` - Project overview v√† conventions
- `/docs/data/schemas/` - Database schema files

### External Resources
- [Next.js Standalone Output](https://nextjs.org/docs/app/api-reference/config/next-config-js/output)
- [Docker Compose Best Practices](https://docs.docker.com/compose/production/)
- [Supabase Self-Hosting](https://supabase.com/docs/guides/self-hosting)
- [PostgreSQL Performance Tuning](https://wiki.postgresql.org/wiki/Performance_Optimization)

---

## üìù Change Log

| Version | Date       | Author | Changes                    |
|---------|------------|--------|----------------------------|
| 1.0     | 2026-02-06 | Kienta | Initial version            |

---

## üë§ Li√™n H·ªá

**Questions ho·∫∑c concerns**: Li√™n h·ªá team lead ho·∫∑c t·∫°o issue trong repo.
